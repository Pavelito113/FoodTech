@using Microsoft.AspNetCore.Identity
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@inject FoodTech.Services.UserClaimsService UserClaimsService

@{
    var userInfo = await UserClaimsService.GetUserInfoAsync();
    string userName = userInfo.Name;
    string userEmail = userInfo.Email;
    string userCompany = userInfo.Company;
    string userPhone = userInfo.Phone;
    bool isAuth = !string.IsNullOrEmpty(userName);
}

<!-- üåê –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ" -->
<div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">

            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="contactModalLabel">
                    <i class="bi bi-envelope me-2"></i>–ó–∞–ø—Ä–æ—Å –ø–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
            </div>

            <!-- –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="modal-header-border bg-light py-2 px-4">
                <p class="text-muted mb-0 small">
                    <i class="bi bi-info-circle me-1"></i>
                    –í—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ: <strong id="selectedEquipmentName" class="text-dark">–Ω–µ –≤—ã–±—Ä–∞–Ω–æ</strong>
                </p>
            </div>

            <!-- –¢–µ–ª–æ -->
            <div class="modal-body">
                <form id="contactForm"
                      asp-controller="Home"
                      asp-action="RequestCreate"
                      method="post"
                      enctype="multipart/form-data"
                      novalidate
                      class="needs-validation">
                    @Html.AntiForgeryToken()

                    <input type="hidden" name="EquipmentId" id="formEquipmentId" />
                    <input type="hidden" name="EquipmentName" id="formEquipmentName" /> 
                    <input type="hidden" name="SourceUrl" id="formSourceUrl" value="@Context.Request.Path" />

                    <!-- –ê–Ω—Ç–∏—Å–ø–∞–º -->
                    <input type="text" name="Honeypot" class="d-none" tabindex="-1" autocomplete="off" />

                    <div class="row g-3">
                        <!-- –ò–º—è -->
                        <div class="col-12">
                            <label for="formName" class="form-label">
                                <i class="bi bi-person me-1"></i>–ò–º—è <span class="text-danger">*</span>
                            </label>
                            <input type="text"
                                   class="form-control"
                                   id="formName"
                                   name="Name"
                                   required
                                   maxlength="240"
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
                                   value="@userName"
                                   @(isAuth ? "readonly" : "")>
                        </div>

                        <!-- Email -->
                        <div class="col-md-6">
                            <label for="formEmail" class="form-label">
                                <i class="bi bi-envelope me-1"></i>Email
                            </label>
                            <input type="email"
                                   class="form-control"
                                   id="formEmail"
                                   name="Email"
                                   maxlength="400"
                                   placeholder="email@example.com"
                                   value="@userEmail"
                                   @(isAuth ? "readonly" : "")>
                        </div>

                        <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
                        <div class="col-md-6">
                            <label for="formPhone" class="form-label">
                                <i class="bi bi-telephone me-1"></i>–¢–µ–ª–µ—Ñ–æ–Ω
                            </label>
                            <input type="tel"
                                   class="form-control"
                                   id="formPhone"
                                   name="Phone"
                                   maxlength="100"
                                   placeholder="+7 (XXX) XXX-XX-XX"
                                   value="@userPhone"
                                   @(isAuth ? "readonly" : "")>
                        </div>

                        <!-- –ö–æ–º–ø–∞–Ω–∏—è -->
                        <div class="col-12">
                            <label for="formCompany" class="form-label">
                                <i class="bi bi-building me-1"></i>–ö–æ–º–ø–∞–Ω–∏—è
                            </label>
                            <input type="text"
                                   class="form-control"
                                   id="formCompany"
                                   name="Company"
                                   maxlength="400"
                                   placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏"
                                   value="@userCompany"
                                   @(isAuth ? "readonly" : "")>
                        </div>

                        <!-- –°–æ–æ–±—â–µ–Ω–∏–µ -->
                        <div class="col-12">
                            <label for="formMessage" class="form-label">
                                <i class="bi bi-chat-text me-1"></i>–°–æ–æ–±—â–µ–Ω–∏–µ <span class="text-danger">*</span>
                            </label>
                            <textarea class="form-control"
                                      id="formMessage"
                                      name="Message"
                                      rows="4"
                                      required
                                      placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å..."></textarea>
                        </div>

                        <!-- –°–æ–≥–ª–∞—Å–∏–µ -->
                        @if (!isAuth)
                        {
                            <div class="col-12">
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                                    <label class="form-check-label" for="agreeTerms">
                                        –Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å
                                        <a href="/Home/Privacy" target="_blank" class="text-decoration-none">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                                        <span class="text-danger">*</span>
                                    </label>
                                </div>
                            </div>
                        }
                    </div>

                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    <div class="mt-4">
                        <div class="alert alert-success d-none alert-dismissible fade show" id="successAlert" role="alert">
                            <i class="bi bi-check-circle-fill me-2"></i>
                            <span id="successMessage"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>

                        <div class="alert alert-danger d-none alert-dismissible fade show" id="errorAlert" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            <span id="errorMessage"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    </div>

                    <!-- –ö–Ω–æ–ø–∫–∞ -->
                    <div class="mt-4 pt-3 border-top">
                        <button type="submit" class="btn btn-primary btn-lg w-100 py-2" id="submitContactForm">
                            <i class="bi bi-send me-2"></i>
                            <span class="submit-text">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</span>
                            <div class="spinner-border spinner-border-sm d-none ms-2" role="status">
                                <span class="visually-hidden">–û—Ç–ø—Ä–∞–≤–∫–∞...</span>
                            </div>
                        </button>
                        <div class="form-text text-center mt-2">
                            –û—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 1 —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
